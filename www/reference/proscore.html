<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Scoring Probabilistic Forecasts — proscore • topmodels</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Scoring Probabilistic Forecasts — proscore"><meta property="og:description" content="Generic function and default method for computing various kinds of scores
for fitted or predicted probability distributions from (regression) models."><meta property="og:image" content="https://topmodels.R-Forge.R-project.org/logo.png"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@MoritzNLang"><meta name="twitter:site" content="@MoritzNLang"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">topmodels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/topmodels.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/goodness_of_fit.html">Goodness of Fit of Probabilistic Regression Models</a>
    </li>
    <li>
      <a href="../articles/graphics.html">Graphics for Assessing Goodness of Fit</a>
    </li>
    <li>
      <a href="../articles/illustration_fifa_2018.html">Illustration: Goals in the 2018 FIFA World Cup</a>
    </li>
    <li>
      <a href="../articles/illustration_rain_ibk.html">Illustration: Precipitation Forecasts in Innsbruck</a>
    </li>
    <li>
      <a href="../articles/illustration_artificial.html">Illustration: Artificial Data</a>
    </li>
    <li>
      <a href="../articles/implementation.html">Implementation Overview</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="../contact.html">Contact</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Scoring Probabilistic Forecasts</h1>
    
    <div class="hidden name"><code>proscore.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Generic function and default method for computing various kinds of scores
for fitted or predicted probability distributions from (regression) models.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">proscore</span><span class="op">(</span>
  <span class="va">object</span>,
  newdata <span class="op">=</span> <span class="cn">NULL</span>,
  na.action <span class="op">=</span> <span class="va">na.pass</span>,
  type <span class="op">=</span> <span class="st">"loglikelihood"</span>,
  drop <span class="op">=</span> <span class="cn">FALSE</span>,
  aggregate <span class="op">=</span> <span class="cn">FALSE</span>,
  <span class="va">...</span>
<span class="op">)</span>

<span class="co"># S3 method for default</span>
<span class="fu">proscore</span><span class="op">(</span>
  <span class="va">object</span>,
  newdata <span class="op">=</span> <span class="cn">NULL</span>,
  na.action <span class="op">=</span> <span class="va">na.pass</span>,
  type <span class="op">=</span> <span class="st">"loglikelihood"</span>,
  drop <span class="op">=</span> <span class="cn">FALSE</span>,
  aggregate <span class="op">=</span> <span class="cn">FALSE</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>a fitted model object. For the <code>default</code> method this
needs to have a <code><a href="https://alexpghayes.github.io/distributions3/reference/prodist.html" class="external-link">prodist</a></code> and a
<code><a href="newresponse.html">newresponse</a></code> method.</p></dd>
<dt>newdata</dt>
<dd><p>optionally, a data frame in which to look for variables with
which to predict and from which to obtain the response variable.
If omitted, the original observations are used.</p></dd>
<dt>na.action</dt>
<dd><p>function determining what should be done with missing
values in <code>newdata</code>.  The default is to employ <code>NA</code>.</p></dd>
<dt>type</dt>
<dd><p>character specifying the type of score to compute. Avaible types:
<code>"loglikelihood"</code> (or equivalently <code>"logs"</code> or <code>"log_pdf"</code>),
<code>"CRPS"</code> (or equivalently <code>"RPS"</code>), <code>"MAE"</code>, and <code>"MSE"</code>.
Upper or lower case spellings can be used interchangably.</p></dd>
<dt>drop</dt>
<dd><p>logical. Should scores be returned in a data frame (default)
or (if possible) dropped to a vector.</p></dd>
<dt>aggregate</dt>
<dd><p>logical or function to be used for aggregating scores across
observations. Setting <code>aggregate = TRUE</code> corresponds to using <code>mean</code>.</p></dd>
<dt>...</dt>
<dd><p>further parameters passed to the <code>aggregate</code> function (if any).</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Either a <code>data.frame</code> of scores (if <code>drop = FALSE</code>, default) or
a named numeric vector (if <code>drop = TRUE</code> and the scores are not a matrix).
The names are the <code>type</code> specified by the user (i.e., are not canonicalized
by partial matching etc.).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The function <code>proscore</code> provides a unified framework for scoring
probabilistic forecasts (in-sample or out-of-sample). The following scores
are currently available, using the following notation: \(Y\) is the predicted
random variable with cumulative distribution function \(F(y)\) and probability
density function \(f(y)\). The actual observation is \(y\).</p>
<p><b>Log-likelihood:</b> Also known as log-score, logarithmic score, or log-density.</p>
<p>$$
  \log f(y)
$$</p>
<p><b>Continuous ranked probability score (CRPS):</b></p>
<p>$$
  \int_{-\infty}^{\infty} \left( F(x) - 1(x \ge y) \right)^2 \mbox{d} x
$$</p>
<p>where \(1(\cdot)\) denotes the indicator function.</p>
<p>In case of a discrete rather than a continuous distribution, the ranked probability
score (RPS) is defined analogously using the sum rather than the integral. In other
words it is then the sum of the squared deviations between the predicted cumulative
probabilities \(F(x)\) and the ideal step function for the actual observation \(y\).</p>
<p><b>Mean absolute error (MAE):</b></p>
<p>$$
  \left| E(Y) - y \right|
$$</p>
<p>where \(E(Y)\) is the expectation of the predicted random variable \(Y\).</p>
<p><b>Mean squared error (MSE):</b></p>
<p>$$
  \left( E(Y) - y \right)^2
$$</p>
<p>Internally, the default <code>proscore</code> method first computes the fitted/predicted
probability distribution object using <code><a href="https://alexpghayes.github.io/distributions3/reference/prodist.html" class="external-link">prodist</a></code>
(corresponding to \(Y\) above) and then obtains the corresponding observation
\(y\) using <code><a href="newresponse.html">newresponse</a></code>. Subsequently, the scores are evaluated
using either the <code><a href="https://alexpghayes.github.io/distributions3/reference/pdf.html" class="external-link">log_pdf</a></code> method,
<code><a href="https://rdrr.io/pkg/scoringRules/man/scores.html" class="external-link">crps</a></code> method, or simply the <code>mean</code>. Finally,
the resulting individual scores per observation can be returned as a full
data frame, or aggregated (e.g., by using <code>mean</code>, <code>sum</code>, or <code>summary</code>, etc.).</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">## Poisson regression model for FIFA 2018 data:</span></span>
<span class="r-in"><span class="co">## number of goals scored by each team in each game, explained by</span></span>
<span class="r-in"><span class="co">## predicted ability difference of the competing teams</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"FIFA2018"</span>, package <span class="op">=</span> <span class="st">"distributions3"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">goals</span> <span class="op">~</span> <span class="va">difference</span>, data <span class="op">=</span> <span class="va">FIFA2018</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## in-sample log-likelihood</span></span>
<span class="r-in"><span class="fu">proscore</span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"loglik"</span>, aggregate <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      loglik</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -177.6971</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'log Lik.' -177.6971 (df=2)</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## compute mean of all available scores</span></span>
<span class="r-in"><span class="fu">proscore</span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LogS"</span>, <span class="st">"CRPS"</span>, <span class="st">"MAE"</span>, <span class="st">"MSE"</span><span class="op">)</span>, aggregate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        LogS      CRPS       MAE      MSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 -1.388258 0.5619936 0.8320441 1.162032</span>
<span class="r-in"><span class="co">## note that "LogS" and "loglik" above are both matched to using</span></span>
<span class="r-in"><span class="co">## the log-likelihood but the user-supplied spelling is preserved</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## prediction using a new data set (final of the tournament)</span></span>
<span class="r-in"><span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">FIFA2018</span>, <span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">proscore</span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">final</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LogLik"</span>, <span class="st">"CRPS"</span>, <span class="st">"MAE"</span>, <span class="st">"MSE"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        LogLik      CRPS      MAE      MSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 127 -2.891437 1.7744030 2.395589 5.738845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 128 -1.741564 0.7205361 1.046213 1.094561</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## least-squares regression for speed and breaking distance of cars</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"cars"</span>, package <span class="op">=</span> <span class="st">"datasets"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">dist</span> <span class="op">~</span> <span class="va">speed</span>, data <span class="op">=</span> <span class="va">cars</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## replicate in-sample residual sum of squares (aka deviance) by taking</span></span>
<span class="r-in"><span class="co">## the sum (rather than the mean) of the squared errors</span></span>
<span class="r-in"><span class="fu">proscore</span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"MSE"</span>, aggregate <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        MSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 11353.52</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 11353.52</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## note that the log-likelihood does not match exactly due to using</span></span>
<span class="r-in"><span class="co">## the least-squares rather than the maximum-likelihood estimate of the</span></span>
<span class="r-in"><span class="co">## error variance (divising by n rather than n - k)</span></span>
<span class="r-in"><span class="fu">proscore</span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"loglikelihood"</span>, aggregate <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   loglikelihood</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      -206.599</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'log Lik.' -206.5784 (df=3)</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Achim Zeileis, Moritz N. Lang, Reto Stauffer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

