<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Probabilistic Forecasting Infrastructure – topmodels</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../topmodels.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Probabilistic Forecasting Infrastructure – topmodels">
<meta property="og:description" content="">
<meta property="og:image" content="https://topmodels.R-Forge.R-project.org/topmodels/vignettes/topmodels.png">
<meta property="og:site_name" content="topmodels">
<meta name="twitter:title" content="Probabilistic Forecasting Infrastructure – topmodels">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://topmodels.R-Forge.R-project.org/topmodels/vignettes/topmodels.png">
<meta name="twitter:image:alt" content="topmodels: Infrastructure for Forecasting and Assessment of Probabilistic Models">
<meta name="twitter:site" content="@AchimZeileis">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../topmodels-wide.png" alt="topmodels logo" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../vignettes/topmodels.html"> 
<span class="menu-text">Get started</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-documentation" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Documentation</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-documentation">
<li>
    <a class="dropdown-item" href="../man/procast.html">
 <span class="dropdown-text">Procast infrastructure</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../man/rootogram.html">
 <span class="dropdown-text">Probabilistic model diagnostics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../man/plot.rootogram.html">
 <span class="dropdown-text">Plotting probabilistic model diagnostics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../man/Empirical.html">
 <span class="dropdown-text">Interfaces to models/distributions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../man/SerumPotassium.html">
 <span class="dropdown-text">Data sets</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-vignettes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Vignettes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-vignettes">
<li>
    <a class="dropdown-item" href="../vignettes/goodness_of_fit.html">
 <span class="dropdown-text">Goodness of Fit of Probabilistic Regression Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/graphics.html">
 <span class="dropdown-text">Graphics for Assessing Goodness of Fit</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/illustration_fifa_2018.html">
 <span class="dropdown-text">Illustration: Goals in the 2018 FIFA World Cup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/illustration_rain_ibk.html">
 <span class="dropdown-text">Illustration: Precipitation Forecasts in Innsbruck</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/illustration_artificial.html">
 <span class="dropdown-text">Illustration: Artificial Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/implementation.html">
 <span class="dropdown-text">Implementation Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../vignettes/procast.html">
 <span class="dropdown-text">Probabilistic Forecasting Infrastructure</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../NEWS.html"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../CITATION.html"> 
<span class="menu-text">Citation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contact.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@zeileis" target="_blank"> <i class="bi bi-mastodon" role="img" aria-label="@zeileis@fosstodon.org">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/AchimZeileis" target="_blank"> <i class="bi bi-twitter-x" role="img" aria-label="@AchimZeileis">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://R-Forge.R-project.org/projects/topmodels" target="_blank"> <i class="bi bi-code-square" role="img" aria-label="topmodels @ R-Forge">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a></li>
  <li>
<a href="#adding-a-new-distribution" id="toc-adding-a-new-distribution" class="nav-link" data-scroll-target="#adding-a-new-distribution"><span class="header-section-number">2</span> Adding a new distribution</a>
  <ul class="collapse">
<li><a href="#class-constructor" id="toc-class-constructor" class="nav-link" data-scroll-target="#class-constructor"><span class="header-section-number">2.1</span> Class constructor</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods"><span class="header-section-number">2.2</span> Methods</a></li>
  </ul>
</li>
  <li><a href="#adding-a-new-model" id="toc-adding-a-new-model" class="nav-link" data-scroll-target="#adding-a-new-model"><span class="header-section-number">3</span> Adding a new model</a></li>
  <li><a href="#further-details" id="toc-further-details" class="nav-link" data-scroll-target="#further-details"><span class="header-section-number">4</span> Further details</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">5</span> References</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header"><h1 class="title display-7">Probabilistic Forecasting Infrastructure</h1>

</header><section id="overview" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="overview">
<span class="header-section-number">1</span> Overview</h2>
<p>The functionality provided by the <code>topmodels</code> package can be broadly placed into three groups:</p>
<ol type="1">
<li>
<em>Numeric quantities:</em> Functions which, based on fitted model objects (like <code>lm</code>, <code>glm</code>, etc.), compute quantities of interest, such as predicted probabilities, quantiles, residuals, etc.</li>
<li>
<em>Visualizations:</em> Functions which can help assess goodness of fit for fitted model objects, leveraging the numeric quantities from above.</li>
<li>
<em>Under the hood:</em> Functions which can extract/predict probability distributions as proper S3 objects and provide standard methods for working with these distributions.</li>
</ol>
<p>The S3 framework for probability distributions (3. above) is actually set up in the <code>distributions3</code> package that <code>topmodels</code> builds upon. Actually, all numeric and graphical functions (1. and 2. above) have “smart” default methods. This means that <em>if necessary</em> methods can be defined for them but all the default methods work out of the box if the <code>distributions3</code> functionality from 3. is provided. The table below shows all of the functions that become directly available when interfacing the <code>distributions3</code> infrastructure.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 78%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Function</th>
<th style="text-align: left;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><em>Numeric quantities</em></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>procast()</code></td>
<td style="text-align: left;">Probabilistic forecasts (probabilities, quantiles, etc.) based on model objects</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>proscore()</code></td>
<td style="text-align: left;">Evaluate scoring rules for procasts</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>proresiduals()</code></td>
<td style="text-align: left;">Residuals for probabilistic regression models (quantile, PIT, Pearson, …)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>Visualizations</em></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pithist()</code></td>
<td style="text-align: left;">PIT histograms</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>qqrplot()</code></td>
<td style="text-align: left;">Q-Q plots for quantile residuals</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>wormplot()</code></td>
<td style="text-align: left;">Worm plots for quantile residuals</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>rootogram()</code></td>
<td style="text-align: left;">Rootograms of observed and fitted frequencies</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>reliagram()</code></td>
<td style="text-align: left;">(Extended) reliability diagrams</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>Under the hood</em></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>prodist()</code></td>
<td style="text-align: left;">Fitted and predicated probability distributions based on model objects</td>
</tr>
<tr class="odd">
<td style="text-align: left;">
<code>Normal()</code>,</td>
<td style="text-align: left;">Probability distribution objects</td>
</tr>
<tr class="even">
<td style="text-align: left;">
<code>Poisson()</code>, …</td>
<td style="text-align: left;">With methods <code><a href="https://rdrr.io/r/grDevices/pdf.html">pdf()</a></code>, <code>cdf()</code>, <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code>, <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, …</td>
</tr>
</tbody>
</table>
<p>Thus, to connect a new class of models to the <code>topmodels</code> tools the following building blocks need to be provided:</p>
<ol type="a">
<li>A class with all necessary methods for the probability distribution of the response variable.</li>
<li>A <code>prodist()</code> method for the model object, which typically first predicts the parameters and then sets up the distribution object from a.</li>
</ol>
<p>Below we illustrate both steps by setting up a so-called “Tobit” model <span class="citation" data-cites="Tobin:1958">(<a href="#ref-Tobin:1958" role="doc-biblioref">Tobin 1958</a>)</span>. This is a model with a normally-distributed response, left-censored at zero, which can in R be fitted with the <code><a href="https://rdrr.io/pkg/crch/man/crch.html">crch()</a></code> function <span class="citation" data-cites="Messner+Mayr+Zeileis:2016">(<a href="#ref-Messner+Mayr+Zeileis:2016" role="doc-biblioref">Messner, Mayr, and Zeileis 2016</a>)</span> from the package of the same name (among other packages). For illustration we first set up a new <code>Tobit()</code> distributions object (which is a special case of the <code><a href="https://rdrr.io/pkg/crch/man/CensoredNormal.html">CensoredNormal()</a></code> class provided in <code>crch</code>). Subsequently, we add a <code>prodist()</code> method for <code>crch</code> objects.</p>
</section><section id="adding-a-new-distribution" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="adding-a-new-distribution">
<span class="header-section-number">2</span> Adding a new distribution</h2>
<p>To illustrate how to set up a <code>distributions3</code> constructor function, we employ the “Tobit” model, i.e., a normal distribution, left-censored at zero. Note that in practice we could just use the <code><a href="https://rdrr.io/pkg/crch/man/CensoredNormal.html">CensoredNormal()</a></code> distribution provided by the <code><a href="https://rdrr.io/pkg/crch/man/crch.html">crch()</a></code> package (with arbitrary left and/or right censoring) as well as the underlying <code><a href="https://rdrr.io/pkg/crch/man/cnorm.html">dcnorm()</a></code>, <code><a href="https://rdrr.io/pkg/crch/man/cnorm.html">pcnorm()</a></code>, <code><a href="https://rdrr.io/pkg/crch/man/cnorm.html">qcnorm()</a></code>, and <code><a href="https://rdrr.io/pkg/crch/man/cnorm.html">rcnorm()</a></code> functions. However, here we avoid doing so and set up the <code>Tobit()</code> class constructor and accompanying methods from scratch, just for illustration.</p>
<section id="class-constructor" class="level3" data-number="2.1"><h3 data-number="2.1" class="anchored" data-anchor-id="class-constructor">
<span class="header-section-number">2.1</span> Class constructor</h3>
<p>First, the constructor (or generator) function for the distribution object should set up a data frame, containing the distribution’s parameters, with a custom class <code>"Tobit"</code> inheriting from <code>"distribution"</code>. In case of the Tobit distribution, the parameters are the mean <code>mu</code> <span class="math inline">\(= \mu\)</span> and standard deviation <code>sigma</code> <span class="math inline">\(= \sigma\)</span> of the underlying uncensored normal distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Tobit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">sigma</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="st">"parameter lengths do not match (only scalars are allowed to be recycled)"</span> <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">n</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">mu</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tobit"</span>, <span class="st">"distribution"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is already sufficient for setting up a vector <code>Y</code> containing three different Tobit distributions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">Tobit</span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tobit(mu = 1, sigma = 1)" "Tobit(mu = 2, sigma = 1)"
[3] "Tobit(mu = 3, sigma = 4)"</code></pre>
</div>
</div>
<p>Printing, subsetting, and some coercion functions already work due to suitable, flexible methods for <code>"distribution"</code> objects in general.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Y</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tobit(mu = 1, sigma = 1)" "Tobit(mu = 3, sigma = 4)"</code></pre>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     mu sigma
[1,]  1     1
[2,]  2     1
[3,]  3     4</code></pre>
</div>
</div>
</section><section id="methods" class="level3" data-number="2.2"><h3 data-number="2.2" class="anchored" data-anchor-id="methods">
<span class="header-section-number">2.2</span> Methods</h3>
<p>Having constructed a distributions object like the <code>"Tobit"</code> object <code>Y</code> above, the next step is to perform standard tasks on it, such as computing densities, probabilities, moments, etc. While in base R the familiar functions of type <code>ddist()</code> (density), <code>pdist()</code> (cumulative probability), <code>qdist()</code> (quantile), and <code>rdist()</code> (random numbers) are typically used (e.g., where <code>dist</code> = <code>norm</code> or <code>pois</code> etc.), the <code>distributions3</code> employs an object-oriented approach. Thus, rather than having the specification of the distribution as part of the function name, it is captured in the class of the object. Based on that suitable generic functions like <code><a href="https://rdrr.io/r/grDevices/pdf.html">pdf()</a></code> (density), <code>cdf()</code> (cumulative probability), etc. can be provided for each distribution class. See the table below for an overview of generic functions and their purpose.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 14%">
<col style="width: 68%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Function</th>
<th style="text-align: left;">Package</th>
<th style="text-align: left;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><em>Distributional</em></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code><a href="https://rdrr.io/r/grDevices/pdf.html">pdf()</a></code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Probability density function (or probability mass function, typically via <code>ddist()</code>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>log_pdf()</code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Log-density (or log-likelihood, typically via <code>ddist(..., log = TRUE)</code>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cdf()</code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Cumulative distribution function (typically via <code>pdist()</code>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code></td>
<td style="text-align: left;"><code>stats</code></td>
<td style="text-align: left;">Compute quantiles (typically via <code>qdist()</code>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>random()</code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Simulate random samples (typically via <code>rdist()</code>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>crps()</code></td>
<td style="text-align: left;"><code>scoringRules</code></td>
<td style="text-align: left;">(Continuous) ranked probability scored (typically via <code>crps_dist()</code>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Moments</em></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code></td>
<td style="text-align: left;"><code>base</code></td>
<td style="text-align: left;">Expectation</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>variance()</code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Variance</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>skewness()</code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Skewness</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>kurtosis()</code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Excess kurtosis</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>Support</em></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>support()</code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Maximum and minimum of the support of the probability distribution</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>is_discrete()</code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Determine whether a distribution is discrete on its support</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>is_continuous()</code></td>
<td style="text-align: left;"><code>distributions3</code></td>
<td style="text-align: left;">Determine whether a distribution is continuous on its support</td>
</tr>
</tbody>
</table>
<p>In the following we just show how the <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> and the <code>cdf()</code> method can be set up and applied. Some further details are provided at the end of this section, see also the underlying source code in the packages.</p>
<p>First, the extractor functions for moments of the distribution can be typically be defined as functions of the list of parameters stored in the object:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mean.Tobit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">mu</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">mu</span><span class="op">/</span><span class="va">x</span><span class="op">$</span><span class="va">sigma</span><span class="op">)</span> <span class="op">+</span> <span class="va">x</span><span class="op">$</span><span class="va">sigma</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">mu</span><span class="op">/</span><span class="va">x</span><span class="op">$</span><span class="va">sigma</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">m</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In a Tobit distribution the expectation is that of the underlying uncensored normal distribution (<code>mu</code>), suitably adjusted with the cumulative distribution function and probability density function of the uncensored distribution. For the three distributions in <code>Y</code> this yields:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.083 2.008 3.525</code></pre>
</div>
</div>
<p>In the first two the effect of censoring is rather small, while in the third distribution it is more pronounced (due to the higher variance).</p>
<p>For evaluating the usual <code>d</code>/<code>p</code>/<code>q</code>/<code>r</code> functions in a standardized way, taking care of dimensions and naming etc., the <code>distributions3</code> package provides the auxiliary function <code>apply_dpqr()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cdf.Tobit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">x</span>, <span class="va">drop</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">elementwise</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">lower.tail</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">log.p</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">FUN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">at</span>, <span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="va">at</span>, mean <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">mu</span>, sd <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">sigma</span>, lower.tail <span class="op">=</span> <span class="va">lower.tail</span>, log.p <span class="op">=</span> <span class="va">log.p</span><span class="op">)</span></span>
<span>    <span class="va">p</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep_len</a></span><span class="op">(</span><span class="va">at</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">lower.tail</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">log.p</span><span class="op">)</span> <span class="op">-</span><span class="cn">Inf</span> <span class="kw">else</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">log.p</span><span class="op">)</span> <span class="fl">0</span> <span class="kw">else</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">p</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">apply_dpqr</span><span class="op">(</span>d <span class="op">=</span> <span class="va">d</span>, FUN <span class="op">=</span> <span class="va">FUN</span>, at <span class="op">=</span> <span class="va">x</span>, type <span class="op">=</span> <span class="st">"probability"</span>, elementwise <span class="op">=</span> <span class="va">elementwise</span>, drop <span class="op">=</span> <span class="va">drop</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This can be used to evaluate all distribution functions at the same argument (returning a vector by default):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">cdf</span><span class="op">(</span><span class="va">Y</span>, <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.15866 0.02275 0.22663</code></pre>
</div>
</div>
<p>Or to evaluate all distribution functions at several arguments (returning a matrix by default):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">cdf</span><span class="op">(</span><span class="va">Y</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         p_0    p_5
[1,] 0.15866 1.0000
[2,] 0.02275 0.9987
[3,] 0.22663 0.6915</code></pre>
</div>
</div>
<p>Finally, if the distribution and the argument have the same length, the default is to do the evaluating elementwise (always returning a vector):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">cdf</span><span class="op">(</span><span class="va">Y</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8413 0.1587 0.2266</code></pre>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">cdf</span><span class="op">(</span><span class="va">Y</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">0</span>, elementwise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8413 0.1587 0.2266</code></pre>
</div>
</div>
<p>But the evaluation can also be forced to be carried out for each combination of distribution and argument (always returning a matrix):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">cdf</span><span class="op">(</span><span class="va">Y</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">0</span>, elementwise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        p_2    p_1     p_0
[1,] 0.8413 0.5000 0.15866
[2,] 0.5000 0.1587 0.02275
[3,] 0.4013 0.3085 0.22663</code></pre>
</div>
</div>
<p>These two additional methods are sufficient for the following illustrations. More details are provided below at the end of this section.</p>
</section></section><section id="adding-a-new-model" class="level2" data-number="3"><h2 data-number="3" class="anchored" data-anchor-id="adding-a-new-model">
<span class="header-section-number">3</span> Adding a new model</h2>
<p>When setting up the procasting infrastructure, the heavy lifting is done with the creation of a suitable distribution class and methods. Interfacing a new model requires only a new <code>prodist()</code> method for setting up the probability distribution object based on a fitted model (and potentially a <code>newdata</code> set). The idea is to extract or predict the distribution parameters (<code>mu</code> and <code>sigma</code> in case of the Tobit distribution) and subsequently call the distribution class constructor (preserving observation names, if any).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prodist.crch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">na.action</span> <span class="op">=</span> <span class="va">na.pass</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">object</span>, newdata <span class="op">=</span> <span class="va">newdata</span>, na.action <span class="op">=</span> <span class="va">na.action</span>, type <span class="op">=</span> <span class="st">"parameter"</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="fu">Tobit</span><span class="op">(</span>mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">par</span><span class="op">$</span><span class="va">location</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="va">par</span><span class="op">$</span><span class="va">scale</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To illustrate how this can be used in practice we fit a heteroscedastic Tobit model using the <code><a href="https://rdrr.io/pkg/crch/man/crch.html">crch()</a></code> function to a precipitation dataset from Innsbruck, Austria. As precipitation is often zero and never can become negative, a Tobit model is typically a good starting point for probabilistic modeling and forecasting. (See FIXME for more details.)</p>
<p>The data can be preprocessed in the following way:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"RainIbk"</span>, package <span class="op">=</span> <span class="st">"crch"</span><span class="op">)</span></span>
<span><span class="va">RainIbk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">RainIbk</span><span class="op">)</span></span>
<span><span class="va">RainIbk</span><span class="op">$</span><span class="va">ensmean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">RainIbk</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">'^rainfc'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">RainIbk</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">RainIbk</span><span class="op">$</span><span class="va">enssd</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">RainIbk</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">'^rainfc'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">RainIbk</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sd</span><span class="op">)</span></span>
<span><span class="va">RainIbk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">RainIbk</span>, <span class="va">enssd</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And the model is fitted via:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://topmodels.R-Forge.R-project.org/crch/">"crch"</a></span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/crch/man/crch.html">crch</a></span><span class="op">(</span><span class="va">rain</span> <span class="op">~</span> <span class="va">ensmean</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">enssd</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">RainIbk</span>, left <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, the predicted Tobit distributions for the first two observations can be obtained with the <code>prodist()</code> method obtained above:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">RainIbk2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">RainIbk</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">prodist</span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">RainIbk2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       2000-01-04                        2000-01-05 
"Tobit(mu = 1.205, sigma = 2.16)" "Tobit(mu = 0.565, sigma = 1.98)" </code></pre>
</div>
</div>
<p>Then, the <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> or <code>cdf()</code> method could be applied to this distribution vector. Alternatively, instead of calling these methods “by hand”, we can use the convenience <code>procast()</code> method to do so:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">procast</span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">RainIbk2</span>, type <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            mean
2000-01-04 1.597
2000-01-05 1.105</code></pre>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">procast</span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="va">RainIbk2</span>, type <span class="op">=</span> <span class="st">"cdf"</span>, at <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           probability
2000-01-04      0.2888
2000-01-05      0.3878</code></pre>
</div>
</div>
<p>Instead of <code>"mean"</code> and <code>"cdf"</code>, we could also use the aliases <code>"response"</code> and <code>"probability"</code>, respectively.</p>
<p>Similarly, other functions such as <code>proscore()</code>, <code>proresiduals()</code>, <code>pithist()</code>, or <code>rootogram()</code> can be used once all of the methods from the table above are defined.</p>
</section><section id="further-details" class="level2" data-number="4"><h2 data-number="4" class="anchored" data-anchor-id="further-details">
<span class="header-section-number">4</span> Further details</h2>
<p>Most of the remaining methods for the distribution objects follow the same structure as the <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> and <code>cdf()</code> method above, respectively. However, the <code>random()</code> and the support-related methods are slightly different. Hence, these are also briefly illustrated in the following.</p>
<p>Drawing <code>random()</code> samples also uses <code>apply_dpqr()</code> with the argument <code>n</code> which is assured to always be a positive integer.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">random.Tobit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">1L</span>, <span class="va">drop</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu">make_positive_integer</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">0L</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">FUN</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">at</span>, <span class="va">d</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">at</span>, mean <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">mu</span>, sd <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">sigma</span><span class="op">)</span></span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">y</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">y</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">apply_dpqr</span><span class="op">(</span>d <span class="op">=</span> <span class="va">x</span>, FUN <span class="op">=</span> <span class="va">FUN</span>, at <span class="op">=</span> <span class="va">n</span>, type <span class="op">=</span> <span class="st">"random"</span>, drop <span class="op">=</span> <span class="va">drop</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If <code>drop = TRUE</code> (the default), then one random sample for each distribution yields a vector, while several random samples for each distribution yields a matrix:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">random</span><span class="op">(</span><span class="va">Y</span>, <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7893 3.4832 0.0000</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">random</span><span class="op">(</span><span class="va">Y</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        r_1   r_2    r_3
[1,] 0.8395 0.000  2.262
[2,] 1.0870 2.804  1.832
[3,] 0.0000 0.000 15.068</code></pre>
</div>
</div>
<p>The <code>support()</code> method should return a matrix of <code>"min"</code> and <code>"max"</code> for the distribution. The <code>make_support()</code> function helps to set the right names and dimension.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">support.Tobit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">drop</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">make_support</span><span class="op">(</span><span class="va">min</span>, <span class="va">max</span>, <span class="va">d</span>, drop <span class="op">=</span> <span class="va">drop</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">support</span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     min max
[1,]   0 Inf
[2,]   0 Inf
[3,]   0 Inf</code></pre>
</div>
</div>
<p>Finally, the <code>is_discrete()</code> and <code>is_continuous()</code> methods should return <code>TRUE</code> for distributions that are discrete or continuous, respectively, on the entire support. Thus, for mixed discrete-continuous distributions like the Tobit, both methods should return <code>FALSE</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">is_discrete.Tobit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep.int</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">is_continuous.Tobit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep.int</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">is_discrete</span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE</code></pre>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">is_continuous</span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE</code></pre>
</div>
</div>
</section><section id="references" class="level2" data-number="5">



</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">
5 References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Messner+Mayr+Zeileis:2016" class="csl-entry" role="listitem">
Messner, Jakob W., Georg J. Mayr, and Achim Zeileis. 2016. <span>“Heteroscedastic Censored and Truncated Regression with <span class="nocase">crch</span>.”</span> <em>The R Journal</em> 8 (1): 173–81. <a href="https://doi.org/10.32614/RJ-2016-012">https://doi.org/10.32614/RJ-2016-012</a>.
</div>
<div id="ref-Tobin:1958" class="csl-entry" role="listitem">
Tobin, J. 1958. <span>“Estimation of Relationships for Limited Dependent Variables.”</span> <em>Econometrica</em> 26 (1): 24–36. <a href="https://doi.org/10.2307/1907382">https://doi.org/10.2307/1907382</a>.
</div>
</div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/topmodels\.R-Forge\.R-project\.org\/topmodels\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>